{% extends 'admin_base.html.twig' %}

{% block body %}
	<div class="mx-auto max-w-screen-lg px-4 py-8 sm:px-8">
		<div class="flex items-center justify-between pb-6">
			<div>
				<h2 class="font-semibold text-gray-700">Liste des utilisateurs</h2>
				<span class="text-xs text-gray-500">Gestion des comptes utilisateurs</span>
			</div>
		</div>

		{% for label, messages in app.flashes %}
			<div class="mb-4">
				<div class="bg-{{ label == 'success' ? 'green' : 'red' }}-100 border-l-4 border-{{ label == 'success' ? 'green' : 'red' }}-500 text-{{ label == 'success' ? 'green' : 'red' }}-700 p-4" role="alert">
					<p class="font-bold">{{ label == 'success' ? 'Succès' : 'Erreur' }}</p>
					<p>{{ messages|join(', ') }}</p>
				</div>
			</div>
		{% endfor %}

		<div class="overflow-y-hidden rounded-lg border">
			<table class="w-full">
				<thead>
					<tr class="bg-blue-600 text-left text-xs font-semibold uppercase tracking-widest text-white">
						<th class="px-5 py-3">Avatar</th>
						<th class="px-5 py-3">Pseudo</th>
						<th class="px-5 py-3">Email</th>
						<th class="px-5 py-3">Rôles</th>
						<th class="px-5 py-3">Actions</th>
					</tr>
				</thead>
				<tbody class="text-gray-500">
					{% for user in users %}
						<tr class="bg-white hover:bg-gray-100">
							<td class="border-b border-gray-200 px-5 py-5 text-sm">
								<div class="flex items-center">
									<div class="h-10 w-10 flex-shrink-0">
										<img class="h-full w-full rounded-full" src="{{ user.avatar ?: asset('medias/avatars/default-avatar.png') }}" alt="Avatar de {{ user.pseudo }}"/>
									</div>
								</div>
							</td>

							<td class="border-b border-gray-200 px-5 py-5 text-sm">
								<div class="ml-3">
									<p class="whitespace-no-wrap">{{ user.pseudo }}</p>
								</div>
							</td>

							<td class="border-b border-gray-200 px-5 py-5 text-sm">
								<p class="whitespace-no-wrap">{{ user.email }}</p>
							</td>

							<td class="border-b border-gray-200 px-5 py-5 text-sm">
								<p class="whitespace-no-wrap">{{ user.roles|join(', ') }}</p>
							</td>

							<td class="border-b border-gray-200 px-5 py-5 text-sm">
								<div class="flex space-x-2">
									<a href="{{ path('admin_users_edit', {'id': user.id}) }}" class="inline-block rounded bg-green-500 px-3 py-1 text-sm font-semibold text-white hover:bg-green-600">
										Éditer
									</a>

									{% if user.id != app.user.id %}
										<form method="post" action="{{ path('admin_user_delete', {'id': user.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');" class="inline-block">
											<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
											<button class="rounded bg-red-500 px-3 py-1 text-sm font-semibold text-white hover:bg-red-600">
												Supprimer
											</button>
										</form>
									{% endif %}
								</div>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
{% endblock %}
